{{>layout/header}}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.css">
<link rel="stylesheet" href="https://uicdn.toast.com/editor/2.0.0/toastui-editor.min.css">
<script src="https://uicdn.toast.com/editor/2.0.0/toastui-editor-all.min.js"></script>

<div style="margin-left: 270px; margin-right: 270px">
    <div class="form-group">
        <p>
            <div id="title" style="height: 66px;">{{problem.title}}</div>
            <div class="fix-btn-container">
                {{#review}}
                    <button class="fix-btn" onclick="location.href='/problems/{{problem.id}}/reviews/{{review.id}}'">수정</button>
                    <button class="fix-btn" onclick="index.deleteReview({{review.id}});">삭제</button>
                {{/review}}
                {{^review}}
                    <button class="fix-btn" onclick="index.deleteProblem({{problem.id}});">삭제</button>
                {{/review}}

            </div>
            <input hidden id="step" value="{{problem.step}}"/>
            <img class="star" width="35" id="star1" src="/image/star_selected.png" onclick="selectStar(1)"><img class="star" width="35" id="star2" src="/image/star_not_selected.png" onclick="selectStar(2)"><img class="star" width="35" id="star3" src="/image/star_not_selected.png" onclick="selectStar(3)"><img class="star" width="35" id="star4" src="/image/star_not_selected.png" onclick="selectStar(4)"><img class="star" width="35" id="star5" src="/image/star_not_selected.png" onclick="selectStar(5)">
             ·&nbsp 알림 예정일 &nbsp<b>{{problem.notificationDate}}</b>&nbsp ·&nbsp&nbsp{{problem.writer.nickname}}
            <script>
                for (let num = 1; num <= {{problem.step}}; num++)
                    document.getElementById("star" + num).src = "/image/star_selected.png";
                for (let num = {{problem.step}} + 1; num <= 5; num++)
                    document.getElementById("star" + num).src = "/image/star_not_selected.png";
            </script>
        </p>
        <div id="tag-block"></div>
    </div>
    <hr>
    <div id="link" tabindex="2" class="sc-jtRlXQ cspOdp"><a href="{{problem.link}}">문제 링크</a></div>
    <hr>
    {{#review}}
        <span id="review-issue">Review#{{index}} · </span><span class="date">{{review.createdDate}}</span>
        <div style="margin-top: 13px;">
                <div id="editor-hidden" hidden style="box-sizing: border-box; margin-top: 5px; height: 500px;">{{review.content}}</div>
                <div id="viewer"></div>
            </div>
        <hr>
    {{/review}}


    <div id="reviewLinkList" class="sc-gHboQg eLpzfs link-block" style="position: fixed; top: 160px; right: 0px;">
        <a href="/problems/{{problem.id}}/reviews" class="btn-secondary btn" style="width: 180px">Add Review</a><br><br>
        <script>
            const reviewLinkElem = document.getElementById("reviewLinkList");
            let reviewLinkContent = '';
            let reviewIndex = 1;
            {{#problem.reviewList}}
                reviewLinkContent += `
                <div class="review-block" style="margin-left: 12px;">
                    ${reviewIndex}. <a href="/problems/{{problem.id}}?index=${reviewIndex}" style="color: rgb(134, 142, 150);"  class="date">{{createdDate}}</a>

                </div>
                `
                reviewIndex += 1;
            {{/problem.reviewList}}

            reviewLinkElem.innerHTML += reviewLinkContent;
        </script>
    </div>
</div>

<script>
    let dateArr = document.getElementsByClassName("date");
    for (let i = 0; i < dateArr.length; i++) {
        dateArr[i].textContent = dateArr[i].textContent.substr(0, 10);
    }

    const content = [].join('\n');

    const viewer = toastui.Editor.factory({
        el: document.querySelector('#viewer'),
        viewer: true,
        height: '500px',
        initialValue: content
    });

    let elem = document.getElementById('editor-hidden');
    console.log(elem.innerText)
    viewer.setMarkdown(elem.innerText);
</script>

<script>
    function selectStar(starNum) {
        console.log(starNum)
        document.getElementById("step").value = starNum
        let num
        for (num = 1; num <= starNum; num++)
            document.getElementById("star" + num).src = "/image/star_selected.png";
        for (num = starNum + 1; num <= 5; num++)
            document.getElementById("star" + num).src = "/image/star_not_selected.png";
    }
</script>

<script type="text/javascript" src="/js/problem.js"></script>

{{>layout/footer}}